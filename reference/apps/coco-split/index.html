
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://github.com/Gradiant/pyodi/reference/apps/coco-split/">
      
      <link rel="shortcut icon" href="../../../images/logo.svg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>split - Python Object Detection Insights</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pyodi.apps.coco.coco_split" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://github.com/Gradiant/pyodi" title="Python Object Detection Insights" class="md-header-nav__button md-logo" aria-label="Python Object Detection Insights">
      
  <img src="../../../images/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Python Object Detection Insights
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              split
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://github.com/Gradiant/pyodi" title="Python Object Detection Insights" class="md-nav__button md-logo" aria-label="Python Object Detection Insights">
      
  <img src="../../../images/logo.svg" alt="logo">

    </a>
    Python Object Detection Insights
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
      
      <label class="md-nav__link" for="nav-3-1">
        apps
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="apps" data-md-level="2">
        <label class="md-nav__title" for="nav-3-1">
          <span class="md-nav__icon md-icon"></span>
          apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1-1" type="checkbox" id="nav-3-1-1" checked>
      
      <label class="md-nav__link" for="nav-3-1-1">
        coco
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="coco" data-md-level="3">
        <label class="md-nav__title" for="nav-3-1-1">
          <span class="md-nav__icon md-icon"></span>
          coco
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../coco-merge/" class="md-nav__link">
        merge
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          split
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        split
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split" class="md-nav__link">
    pyodi.apps.coco.coco_split
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split--coco-split-app" class="md-nav__link">
    Coco Split App.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split--api-reference" class="md-nav__link">
    API REFERENCE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split.property_split" class="md-nav__link">
    property_split()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split.random_split" class="md-nav__link">
    random_split()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1-2" type="checkbox" id="nav-3-1-2" >
      
      <label class="md-nav__link" for="nav-3-1-2">
        crops
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="crops" data-md-level="3">
        <label class="md-nav__title" for="nav-3-1-2">
          <span class="md-nav__icon md-icon"></span>
          crops
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../crops-merge/" class="md-nav__link">
        merge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../crops-split/" class="md-nav__link">
        split
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        evaluation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ground-truth/" class="md-nav__link">
        ground-truth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paint-annotations/" class="md-nav__link">
        paint-annotations
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1-6" type="checkbox" id="nav-3-1-6" >
      
      <label class="md-nav__link" for="nav-3-1-6">
        train-config
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="train-config" data-md-level="3">
        <label class="md-nav__title" for="nav-3-1-6">
          <span class="md-nav__icon md-icon"></span>
          train-config
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../train-config-evaluation/" class="md-nav__link">
        evaluation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../train-config-generation/" class="md-nav__link">
        generation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" >
      
      <label class="md-nav__link" for="nav-3-2">
        core
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="core" data-md-level="2">
        <label class="md-nav__title" for="nav-3-2">
          <span class="md-nav__icon md-icon"></span>
          core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/anchor_generator/" class="md-nav__link">
        anchor_generator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/boxes/" class="md-nav__link">
        boxes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/clustering/" class="md-nav__link">
        clustering
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/crops/" class="md-nav__link">
        crops
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/nms/" class="md-nav__link">
        nms
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../core/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3" >
      
      <label class="md-nav__link" for="nav-3-3">
        plots
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="plots" data-md-level="2">
        <label class="md-nav__title" for="nav-3-3">
          <span class="md-nav__icon md-icon"></span>
          plots
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../plots/boxes/" class="md-nav__link">
        boxes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../plots/clustering/" class="md-nav__link">
        clustering
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../plots/common/" class="md-nav__link">
        common
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../plots/evaluation/" class="md-nav__link">
        evaluation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split" class="md-nav__link">
    pyodi.apps.coco.coco_split
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split--coco-split-app" class="md-nav__link">
    Coco Split App.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split--api-reference" class="md-nav__link">
    API REFERENCE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split.property_split" class="md-nav__link">
    property_split()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyodi.apps.coco.coco_split.random_split" class="md-nav__link">
    random_split()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>split</h1>
                
                <div class="doc doc-object doc-module">
<h2 class="hidden-toc" id="pyodi.apps.coco.coco_split" style="visibility: hidden; position: absolute;">
        </h2>
<div class="doc doc-contents first">
<h2 id="pyodi.apps.coco.coco_split--coco-split-app">Coco Split App.</h2>
<p>The <a href="#pyodi.apps.coco.coco_split"><code>pyodi coco split</code></a> app can be used to split COCO
annotation files in train and val annotations files.</p>
<p>There are two modes: 'random' or 'property'. The 'random' mode splits randomly the COCO file, while
the 'property' mode allows to customize the split operation based in the properties of the COCO
annotations file.</p>
<p>Example usage:</p>
<div class="codehilite">
<pre><span></span><code>pyodi coco random-split ./coco.json ./random_coco_split --val-percentage <span class="m">0</span>.1
</code></pre>
</div>
<div class="codehilite">
<pre><span></span><code>pyodi coco property-split ./coco.json ./property_coco_split ./split_config.json
</code></pre>
</div>
<p>The split config file is a json file that has 2 keys: 'discard' and 'val', both with dictionary values. The keys of the
dictionaries will be the properties of the images that we want to match, and the values can be either the regex string to
match or, for human readability, a dictionary with keys (you can choose whatever you want) and values (the regex string).</p>
<p>Split config example:</p>
<div class="codehilite">
<pre><span></span><code><span class="p">{</span>
    <span class="s2">"discard"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"file_name"</span><span class="p">:</span> <span class="s2">"people_video|crowd_video|multiple_people_video"</span><span class="p">,</span>
        <span class="s2">"source"</span><span class="p">:</span> <span class="s2">"Youtube People Dataset|Bad Dataset"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">"val"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"file_name"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"My Val Ground Vehicle Dataset"</span><span class="p">:</span> <span class="s2">"val_car_video|val_bus_video|val_moto_video|val_bike_video"</span><span class="p">,</span>
            <span class="s2">"My Val Flying Vehicle Dataset"</span><span class="p">:</span> <span class="s2">"val_plane_video|val_drone_video|val_helicopter_video"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"source"</span><span class="p">:</span> <span class="s2">"Val Dataset"</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<hr />
<h2 id="pyodi.apps.coco.coco_split--api-reference">API REFERENCE</h2>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="pyodi.apps.coco.coco_split.property_split">

<code class="highlight language-python"><span class="n">property_split</span><span class="p">(</span><span class="n">annotations_file</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">split_config_file</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Split the annotations file in training and validation subsets by properties.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>annotations_file</code></td>
<td><code>str</code></td>
<td>
<p>Path to annotations file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>output_filename</code></td>
<td><code>str</code></td>
<td>
<p>Output filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>split_config_file</code></td>
<td><code>str</code></td>
<td>
<p>Path to configuration file.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List[str]</code></td>
<td>
<p>Output filenames.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>pyodi/apps/coco/coco_split.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@logger</span><span class="o">.</span><span class="n">catch</span>  <span class="c1"># noqa: C901</span>
<span class="k">def</span> <span class="nf">property_split</span><span class="p">(</span>
    <span class="n">annotations_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split_config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">"""Split the annotations file in training and validation subsets by properties.</span>

<span class="sd">    Args:</span>
<span class="sd">        annotations_file: Path to annotations file.</span>
<span class="sd">        output_filename: Output filename.</span>
<span class="sd">        split_config_file: Path to configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Output filenames.</span>

<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Loading files..."</span><span class="p">)</span>
    <span class="n">split_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">split_config_file</span><span class="p">)))</span>
    <span class="n">split_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Transform split_config from human readable format to a more code efficient format</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">split_config</span><span class="p">:</span>  <span class="c1"># sections: val / discard</span>
        <span class="k">for</span> <span class="n">property_name</span><span class="p">,</span> <span class="n">property_value</span> <span class="ow">in</span> <span class="n">split_config</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">property_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">property_value</span> <span class="o">=</span> <span class="s2">"|"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">property_value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">split_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">split</span><span class="o">=</span><span class="n">section</span><span class="p">,</span>
                    <span class="n">property_name</span><span class="o">=</span><span class="n">property_name</span><span class="p">,</span>
                    <span class="n">property_regex</span><span class="o">=</span><span class="n">property_value</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">annotations_file</span><span class="p">))</span>

    <span class="n">train_images</span><span class="p">,</span> <span class="n">val_images</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">train_annotations</span><span class="p">,</span> <span class="n">val_annotations</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">n_train_imgs</span><span class="p">,</span> <span class="n">n_val_imgs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">n_train_anns</span><span class="p">,</span> <span class="n">n_val_anns</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">old_to_new_train_ids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old_to_new_val_ids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Gathering images..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"images"</span><span class="p">]:</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="n">split_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"property_regex"</span><span class="p">],</span> <span class="n">img</span><span class="p">[</span><span class="n">split_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"property_name"</span><span class="p">]]</span>
        <span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_list</span><span class="p">):</span>  <span class="c1"># discard or val</span>
            <span class="k">if</span> <span class="n">split_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"split"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"val"</span><span class="p">:</span>
                <span class="n">old_to_new_val_ids</span><span class="p">[</span><span class="n">img</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]]</span> <span class="o">=</span> <span class="n">n_val_imgs</span>
                <span class="n">img</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_val_imgs</span>
                <span class="n">val_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="n">n_val_imgs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># train</span>
            <span class="n">old_to_new_train_ids</span><span class="p">[</span><span class="n">img</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]]</span> <span class="o">=</span> <span class="n">n_train_imgs</span>
            <span class="n">img</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_train_imgs</span>
            <span class="n">train_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">n_train_imgs</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Gathering annotations..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"annotations"</span><span class="p">]:</span>

        <span class="k">if</span> <span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]</span> <span class="ow">in</span> <span class="n">old_to_new_val_ids</span><span class="p">:</span>
            <span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_to_new_val_ids</span><span class="p">[</span><span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]]</span>
            <span class="n">ann</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_val_anns</span>
            <span class="n">val_annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
            <span class="n">n_val_anns</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]</span> <span class="ow">in</span> <span class="n">old_to_new_train_ids</span><span class="p">:</span>
            <span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_to_new_train_ids</span><span class="p">[</span><span class="n">ann</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]]</span>
            <span class="n">ann</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_train_anns</span>
            <span class="n">train_annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
            <span class="n">n_train_anns</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Spliting data..."</span><span class="p">)</span>
    <span class="n">train_split</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"images"</span><span class="p">:</span> <span class="n">train_images</span><span class="p">,</span>
        <span class="s2">"annotations"</span><span class="p">:</span> <span class="n">train_annotations</span><span class="p">,</span>
        <span class="s2">"info"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"licenses"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"licenses"</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="s2">"categories"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">val_split</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"images"</span><span class="p">:</span> <span class="n">val_images</span><span class="p">,</span>
        <span class="s2">"annotations"</span><span class="p">:</span> <span class="n">val_annotations</span><span class="p">,</span>
        <span class="s2">"info"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"licenses"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"licenses"</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="s2">"categories"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Writing splited files..."</span><span class="p">)</span>
    <span class="n">output_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">split_type</span><span class="p">,</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">"train"</span><span class="p">,</span> <span class="s2">"val"</span><span class="p">],</span> <span class="p">[</span><span class="n">train_split</span><span class="p">,</span> <span class="n">val_split</span><span class="p">]):</span>
        <span class="n">output_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_filename</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">"_</span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2">.json"</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_files</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="pyodi.apps.coco.coco_split.random_split">

<code class="highlight language-python"><span class="n">random_split</span><span class="p">(</span><span class="n">annotations_file</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">val_percentage</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">47</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Split the annotations file in training and validation subsets randomly.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>annotations_file</code></td>
<td><code>str</code></td>
<td>
<p>Path to annotations file.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>output_filename</code></td>
<td><code>str</code></td>
<td>
<p>Output filename.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>val_percentage</code></td>
<td><code>float</code></td>
<td>
<p>Percentage of validation images. Defaults to 0.25.</p>
</td>
<td><code>0.25</code></td>
</tr>
<tr>
<td><code>seed</code></td>
<td><code>int</code></td>
<td>
<p>Seed for the random generator. Defaults to 47.</p>
</td>
<td><code>47</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List[str]</code></td>
<td>
<p>Output filenames.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>pyodi/apps/coco/coco_split.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@logger</span><span class="o">.</span><span class="n">catch</span>
<span class="k">def</span> <span class="nf">random_split</span><span class="p">(</span>
    <span class="n">annotations_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">val_percentage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">47</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">"""Split the annotations file in training and validation subsets randomly.</span>

<span class="sd">    Args:</span>
<span class="sd">        annotations_file: Path to annotations file.</span>
<span class="sd">        output_filename: Output filename.</span>
<span class="sd">        val_percentage: Percentage of validation images. Defaults to 0.25.</span>
<span class="sd">        seed: Seed for the random generator. Defaults to 47.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Output filenames.</span>

<span class="sd">    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">annotations_file</span><span class="p">))</span>
    <span class="n">train_images</span><span class="p">,</span> <span class="n">val_images</span><span class="p">,</span> <span class="n">val_ids</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">rand_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"images"</span><span class="p">]))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Gathering images..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"images"</span><span class="p">]):</span>

        <span class="k">if</span> <span class="n">rand_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">val_percentage</span><span class="p">:</span>
            <span class="n">val_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
            <span class="n">val_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">train_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>

    <span class="n">train_annotations</span><span class="p">,</span> <span class="n">val_annotations</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Gathering annotations..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"annotations"</span><span class="p">]:</span>

        <span class="k">if</span> <span class="n">annotation</span><span class="p">[</span><span class="s2">"image_id"</span><span class="p">]</span> <span class="ow">in</span> <span class="n">val_ids</span><span class="p">:</span>
            <span class="n">val_annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">annotation</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">train_annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">annotation</span><span class="p">))</span>

    <span class="n">train_split</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"images"</span><span class="p">:</span> <span class="n">train_images</span><span class="p">,</span>
        <span class="s2">"annotations"</span><span class="p">:</span> <span class="n">train_annotations</span><span class="p">,</span>
        <span class="s2">"info"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"licenses"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"licenses"</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="s2">"categories"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">val_split</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"images"</span><span class="p">:</span> <span class="n">val_images</span><span class="p">,</span>
        <span class="s2">"annotations"</span><span class="p">:</span> <span class="n">val_annotations</span><span class="p">,</span>
        <span class="s2">"info"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="s2">"licenses"</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"licenses"</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="s2">"categories"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">"categories"</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Saving splits to file..."</span><span class="p">)</span>
    <span class="n">output_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">split_type</span><span class="p">,</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">"train"</span><span class="p">,</span> <span class="s2">"val"</span><span class="p">],</span> <span class="p">[</span><span class="n">train_split</span><span class="p">,</span> <span class="n">val_split</span><span class="p">]):</span>
        <span class="n">output_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_filename</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">"_</span><span class="si">{</span><span class="n">split_type</span><span class="si">}</span><span class="s2">.json"</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_files</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../coco-merge/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                merge
              </div>
            </div>
          </a>
        
        
          <a href="../crops-merge/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                merge
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>